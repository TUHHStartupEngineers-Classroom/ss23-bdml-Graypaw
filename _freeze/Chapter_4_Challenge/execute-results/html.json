{
  "hash": "41e89aa417822417097a04981675bca6",
  "result": {
    "markdown": "Load dataset\n\n::: {.cell hash='Chapter_4_Challenge_cache/html/unnamed-chunk-1_3617ec9d00f15e8513d3b792a5c757cb'}\n\n```{.r .cell-code}\ndataset <- read.csv(\"product_backorders.csv\")\n```\n:::\n\n\nPreprocessing\n\n::: {.cell hash='Chapter_4_Challenge_cache/html/unnamed-chunk-2_4948711dea4c0a653b6286ae8c101c98'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(recipes)\n\ndata_recipe <- recipe(went_on_backorder ~ ., data = dataset) %>%\n  step_dummy(all_nominal(), -all_outcomes()) %>%\n  step_zv(all_predictors()) %>%\n  step_normalize(all_predictors()) %>%\n  prep()\n\nprepared_data <- bake(data_recipe, new_data = dataset)\n```\n:::\n\n\nSplitting into training and testing\n\n::: {.cell hash='Chapter_4_Challenge_cache/html/unnamed-chunk-3_2b48a54b1983d1db2f703241f2f65950'}\n\n```{.r .cell-code}\nlibrary(rsample)\nlibrary(h2o)\n\nh2o.init()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Connection successful!\n\nR is connected to the H2O cluster: \n    H2O cluster uptime:         18 minutes 54 seconds \n    H2O cluster timezone:       Europe/Berlin \n    H2O data parsing timezone:  UTC \n    H2O cluster version:        3.40.0.4 \n    H2O cluster version age:    1 month and 17 days \n    H2O cluster name:           H2O_started_from_R_jakbo_whs664 \n    H2O cluster total nodes:    1 \n    H2O cluster total memory:   3.15 GB \n    H2O cluster total cores:    8 \n    H2O cluster allowed cores:  8 \n    H2O cluster healthy:        TRUE \n    H2O Connection ip:          localhost \n    H2O Connection port:        54321 \n    H2O Connection proxy:       NA \n    H2O Internal Security:      FALSE \n    R Version:                  R version 4.3.0 (2023-04-21 ucrt) \n```\n:::\n\n```{.r .cell-code}\nsplit_h2o <- h2o.splitFrame(as.h2o(prepared_data), ratios = c(0.85))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n```{.r .cell-code}\ntrain_h2o <- split_h2o[[1]]\nvalid_h2o <- split_h2o[[2]]\n```\n:::\n\n\nSpecifying variables\n\n::: {.cell hash='Chapter_4_Challenge_cache/html/unnamed-chunk-4_342336cbacaa128d9d06a4d2ada37fc1'}\n\n```{.r .cell-code}\n# Set the target and predictors\ny <- \"went_on_backorder\"\nx <- setdiff(names(train_h2o), y)\n```\n:::\n\n\nGet h2o and start auto-ML-ing\n\n::: {.cell hash='Chapter_4_Challenge_cache/html/unnamed-chunk-5_6bb15bab2cedd253fa7f2179ca8c06ff'}\n\n```{.r .cell-code}\nautoml <- h2o.automl(\n  x = x,\n  y = y,\n  training_frame = train_h2o,\n  validation_frame = valid_h2o,\n  max_runtime_secs = 300,\n  nfolds = 5\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n  |                                                                            \n  |                                                                      |   0%\n02:34:03.803: User specified a validation frame with cross-validation still enabled. Please note that the models will still be validated using cross-validation only, the validation frame will be used to provide purely informative validation metrics on the trained models.\n02:34:03.817: AutoML: XGBoost is not available; skipping it.\n  |                                                                            \n  |==                                                                    |   2%\n  |                                                                            \n  |==                                                                    |   3%\n  |                                                                            \n  |===                                                                   |   4%\n  |                                                                            \n  |===                                                                   |   5%\n  |                                                                            \n  |====                                                                  |   6%\n  |                                                                            \n  |=====                                                                 |   7%\n  |                                                                            \n  |=====                                                                 |   8%\n  |                                                                            \n  |======                                                                |   8%\n  |                                                                            \n  |======                                                                |   9%\n  |                                                                            \n  |=======                                                               |  10%\n  |                                                                            \n  |========                                                              |  11%\n  |                                                                            \n  |========                                                              |  12%\n  |                                                                            \n  |=========                                                             |  12%\n  |                                                                            \n  |=========                                                             |  13%\n  |                                                                            \n  |==========                                                            |  14%\n  |                                                                            \n  |==========                                                            |  15%\n  |                                                                            \n  |=============                                                         |  18%\n  |                                                                            \n  |=============                                                         |  19%\n  |                                                                            \n  |==============                                                        |  19%\n  |                                                                            \n  |==============                                                        |  20%\n  |                                                                            \n  |===============                                                       |  21%\n  |                                                                            \n  |===============                                                       |  22%\n  |                                                                            \n  |================                                                      |  23%\n  |                                                                            \n  |=================                                                     |  24%\n  |                                                                            \n  |==================                                                    |  26%\n  |                                                                            \n  |====================                                                  |  28%\n  |                                                                            \n  |====================                                                  |  29%\n  |                                                                            \n  |=====================                                                 |  29%\n  |                                                                            \n  |=====================                                                 |  30%\n  |                                                                            \n  |=====================                                                 |  31%\n  |                                                                            \n  |======================                                                |  31%\n  |                                                                            \n  |======================                                                |  32%\n  |                                                                            \n  |=======================                                               |  32%\n  |                                                                            \n  |=======================                                               |  33%\n  |                                                                            \n  |========================                                              |  34%\n  |                                                                            \n  |=========================                                             |  35%\n  |                                                                            \n  |=========================                                             |  36%\n  |                                                                            \n  |==========================                                            |  36%\n  |                                                                            \n  |==========================                                            |  37%\n  |                                                                            \n  |===========================                                           |  38%\n  |                                                                            \n  |===========================                                           |  39%\n  |                                                                            \n  |============================                                          |  40%\n  |                                                                            \n  |============================                                          |  41%\n  |                                                                            \n  |=============================                                         |  41%\n  |                                                                            \n  |=============================                                         |  42%\n  |                                                                            \n  |==============================                                        |  43%\n  |                                                                            \n  |===============================                                       |  44%\n  |                                                                            \n  |===============================                                       |  45%\n  |                                                                            \n  |================================                                      |  45%\n  |                                                                            \n  |================================                                      |  46%\n  |                                                                            \n  |=================================                                     |  47%\n  |                                                                            \n  |=================================                                     |  48%\n  |                                                                            \n  |==================================                                    |  48%\n  |                                                                            \n  |==================================                                    |  49%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |====================================                                  |  51%\n  |                                                                            \n  |====================================                                  |  52%\n  |                                                                            \n  |=====================================                                 |  52%\n  |                                                                            \n  |=====================================                                 |  53%\n  |                                                                            \n  |======================================                                |  54%\n  |                                                                            \n  |======================================                                |  55%\n  |                                                                            \n  |=======================================                               |  55%\n  |                                                                            \n  |=======================================                               |  56%\n  |                                                                            \n  |========================================                              |  57%\n  |                                                                            \n  |=========================================                             |  58%\n  |                                                                            \n  |=========================================                             |  59%\n  |                                                                            \n  |==========================================                            |  59%\n  |                                                                            \n  |==========================================                            |  60%\n  |                                                                            \n  |===========================================                           |  61%\n  |                                                                            \n  |============================================                          |  62%\n  |                                                                            \n  |============================================                          |  63%\n  |                                                                            \n  |============================================                          |  64%\n  |                                                                            \n  |=============================================                         |  64%\n  |                                                                            \n  |=============================================                         |  65%\n  |                                                                            \n  |==============================================                        |  66%\n  |                                                                            \n  |===============================================                       |  67%\n  |                                                                            \n  |===============================================                       |  68%\n  |                                                                            \n  |================================================                      |  69%\n  |                                                                            \n  |=================================================                     |  69%\n  |                                                                            \n  |=================================================                     |  70%\n  |                                                                            \n  |==================================================                    |  71%\n  |                                                                            \n  |==================================================                    |  72%\n  |                                                                            \n  |===================================================                   |  73%\n  |                                                                            \n  |====================================================                  |  74%\n  |                                                                            \n  |=====================================================                 |  75%\n  |                                                                            \n  |=====================================================                 |  76%\n  |                                                                            \n  |======================================================                |  77%\n  |                                                                            \n  |=======================================================               |  78%\n  |                                                                            \n  |=======================================================               |  79%\n  |                                                                            \n  |========================================================              |  80%\n  |                                                                            \n  |========================================================              |  81%\n  |                                                                            \n  |=========================================================             |  81%\n  |                                                                            \n  |==========================================================            |  82%\n  |                                                                            \n  |==========================================================            |  83%\n  |                                                                            \n  |===========================================================           |  84%\n  |                                                                            \n  |===========================================================           |  85%\n  |                                                                            \n  |============================================================          |  85%\n  |                                                                            \n  |============================================================          |  86%\n  |                                                                            \n  |=============================================================         |  87%\n  |                                                                            \n  |=============================================================         |  88%\n  |                                                                            \n  |==============================================================        |  89%\n  |                                                                            \n  |===============================================================       |  89%\n  |                                                                            \n  |===============================================================       |  90%\n  |                                                                            \n  |================================================================      |  91%\n  |                                                                            \n  |================================================================      |  92%\n  |                                                                            \n  |=================================================================     |  92%\n  |                                                                            \n  |=================================================================     |  93%\n  |                                                                            \n  |==================================================================    |  94%\n  |                                                                            \n  |===================================================================   |  96%\n  |                                                                            \n  |====================================================================  |  96%\n  |                                                                            \n  |===================================================================== |  98%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n:::\n\n\nGet some info about the results\n\n::: {.cell hash='Chapter_4_Challenge_cache/html/unnamed-chunk-6_e33c88aff5c4fab1fea5363a3882a444'}\n\n```{.r .cell-code}\nleaderboard <- automl@leaderboard\nleaderboard\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                                                model_id       auc   logloss\n1    StackedEnsemble_AllModels_3_AutoML_1_20230615_23403 0.9589026 0.1587188\n2    StackedEnsemble_AllModels_2_AutoML_1_20230615_23403 0.9581103 0.1600754\n3 StackedEnsemble_BestOfFamily_3_AutoML_1_20230615_23403 0.9574718 0.1612398\n4 StackedEnsemble_BestOfFamily_4_AutoML_1_20230615_23403 0.9571658 0.1614802\n5    StackedEnsemble_AllModels_1_AutoML_1_20230615_23403 0.9569760 0.1618418\n6 StackedEnsemble_BestOfFamily_2_AutoML_1_20230615_23403 0.9558707 0.1635940\n      aucpr mean_per_class_error      rmse        mse\n1 0.7748415            0.1370284 0.2171936 0.04717304\n2 0.7697244            0.1431218 0.2183639 0.04768280\n3 0.7660405            0.1624225 0.2190286 0.04797351\n4 0.7654360            0.1609661 0.2189755 0.04795026\n5 0.7663680            0.1604287 0.2194169 0.04814379\n6 0.7606197            0.1386774 0.2203622 0.04855950\n\n[43 rows x 7 columns] \n```\n:::\n:::\n\n\nGet the best model by metrics and make predictions using it\n\n::: {.cell hash='Chapter_4_Challenge_cache/html/unnamed-chunk-7_8797b9bc74ea8cb719cb41fe8a2bbe5b'}\n\n```{.r .cell-code}\ntest_h2o <- h2o.splitFrame(as.h2o(prepared_data), ratios = c(0.85))[[2]]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n```{.r .cell-code}\nbest_model <- automl@leader\npredictions <- h2o.predict(best_model, newdata = test_h2o)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n```{.r .cell-code}\npredictions\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  predict         No       Yes\n1     Yes 0.05700387 0.9429961\n2     Yes 0.23104370 0.7689563\n3     Yes 0.08389635 0.9161037\n4     Yes 0.50629080 0.4937092\n5     Yes 0.05008582 0.9499142\n6     Yes 0.12552236 0.8744776\n\n[2892 rows x 3 columns] \n```\n:::\n:::\n\n\nSaving the best model\n\n::: {.cell hash='Chapter_4_Challenge_cache/html/unnamed-chunk-8_695c998c03d82486d47e9628b3364412'}\n\n```{.r .cell-code}\nh2o.saveModel(best_model, path = \".\\\\leadermodel_h2o\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"C:\\\\Users\\\\jakbo\\\\OneDrive\\\\Documents\\\\Studium\\\\MS1\\\\R_Stuff\\\\ss23-bdml-Graypaw\\\\leadermodel_h2o\\\\StackedEnsemble_AllModels_3_AutoML_1_20230615_23403\"\n```\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}